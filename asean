{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "params": [
        {
            "name": "Year_selection",
            "value": 2010,
            "bind": {
                "input": "range",
                "min": 2010,
                "max": 2021,
                "step": 1,
                "name": "Year:  "
            }
        },
        {
            "name": "zoom_level",
            "value": 1050,
            "bind": {
                "input": "range",
                "min": 800,
                "max": 10000,
                "step": 100,
                "name": "Zoom: "
            }
        },
        {
            "name": "center_to",
            "value": [94, 5.5],
            "bind": {
                "input": "select",
                "options": [
                    [94, 5.5],
                    [112.73, 4.54],
                    [98.99, 13.56],  
                    [95.9, 2.99],   
                    [99.5, 17.86],   
                    [100, 6.21],      
                    [90.95, 17.92],   
                    [113.96, 12.6],   
                    [102, 1.35],      
                    [90.99, 13.87],  
                    [100.66, 15.82]   
                ],
                "labels": [
                    "All",
                    "Brunei", 
                    "Cambodia", 
                    "Indonesia", 
                    "Lao PDR", 
                    "Malaysia", 
                    "Myanmar", 
                    "Philippines", 
                    "Singapore", 
                    "Thailand", 
                    "Vietnam"
                ],
                "name": "Center:  "
            }
        }
        
    ],
    "hconcat": [
        {
            "width": 625,
            "height": 450,
            "projection": {
                "type": "equirectangular",
                "center": { "expr": "center_to" },
                "scale": { "expr": "zoom_level" }
            },
            "layer": [
                {
                    "data": {
                        "url": "data/countries.json",
                        "format": {"type": "topojson", "feature": "countries"}
                    },
                    "transform": 
                    [
                        {
                            "calculate": "'Data is not available in ' + datum.properties.name",
                            "as": "note"
                        }
                    ],
                    "mark": {
                        "type": "geoshape",
                        "fill": "#ddd",
                        "stroke": "white",
                        "strokeWidth": 1
                    },
                    "encoding": {"tooltip": {"field": "note"}}
                },
               {
                    "data": {
                        "url": "data/oceans.topo.json",
                        "format": {"type": "topojson", "feature": "oceans"}
                    },
                    "mark": {"type": "geoshape", "fill":"aliceblue"}
                },
                {
                    "data": {
                        "url": "data/ne_110m_graticules_10.json",
                        "format": {"type": "topojson", "feature": "ne_110m_graticules_10"}
                    },
                    "mark":{"type": "geoshape", "fill": null, "stroke": "lightgray"}
                },
                {    
                    "params": [
                        {
                            "name": "countryHover",
                            "select": {
                                "type": "point", 
                                "on": "mouseover",
                                "clear": "mouseout",
                                "fields": ["Country"]
                            }
                        }],
                    "data": {
                        "url": "data/asean_data.csv"
                    },
                    "transform": [
                        {
                            "lookup": "Country",
                            "from": {
                                "data": {
                                    "url": "data/countries.json",
                                    "format": {"type": "topojson", "feature": "countries"}
                                },
                                "key": "properties.name"
                            }, "as" : "geo"
                        },
                        { "filter": "datum.Year == Year_selection" }
                    ],
                    "mark": { "type": "geoshape", "stroke": "#fff", "strokeWidth": 0.5 },
                    "encoding": {
                        "shape": { "field": "geo", "type": "geojson" },
                        "color": {
                            "field": "Internet users (% of population)",
                            "type": "quantitative",
                            "scale": {
                                "type": "threshold",
                                "domain": [10,30,50,70,90],
                                "range": ["#ffe6cc", "#ffcc99", "#ffb74d", "#ffa726", "#ff8c00", "#e65100"]
                            },
                            "legend":{"title":"Internet Users (% of population)","orient": "top"}
                            
                        },
                        "stroke": {
                            "condition": {"param": "countryHover",
                                          "empty": false, 
                                          "value": "black"
                                          },
                            "value": "lightblack"
                          },
                          "strokeWidth": {
                            "condition": {"param": "countryHover",
                                          "empty": false, 
                                          "value": 1
                                          },
                            "value": 0.3
                          },
                          "opacity": {
                            "condition": {"param": "countryHover",
                                          "value": 1
                                          },
                            "value": 0.5
                          },
                        "tooltip": [
                            {"field": "Country", "type": "nominal", "title":"Country"},
                            {"field": "Internet users (% of population)", "type": "quantitative", "title":"Internet users (%)", "format": ".2f"}
                        ]
                    }
                },
                {
                    "data": {
                        "url": "data/asean_lat.csv"
                    },
                    "mark": {"type": "text","dy":10,"fontWeight":"bold","fontStyle":"italic","color":"#432109"},
                    "encoding": {
                      "longitude": {"field": "longitude", "type": "quantitative"},
                      "latitude": {"field": "latitude", "type": "quantitative"},
                      "text": {
                        "field": "name", 
                        "type": "nominal"
                      },
                      "opacity": {
                        "condition": 
                        [
                            {
                                "test": "datum['name'] == 'Malaysia' || datum['name'] == 'Singapore' || datum['name'] == 'Brunei' ",
                                "value": 1
                            }
                         ],
                        "value": 0
                      }
                    }
                }
            ]
        },
        {
            "params": [
                {
                    "name": "countryHover",
                    "select": {
                        "type": "point", 
                        "on": "mouseover",
                        "clear": "mouseout",
                        "fields": ["Country"]
                    }
                }],
            "width": 275,
            "height": 450,
            "data": {
                "url": "data/asean_data.csv"
            },
            "transform": [
                { "filter": "datum.Year == Year_selection" },
                {
                    "calculate": "datum['Internet users (% of population)']",
                    "as": "InternetUsers"
                }
            ],
            "mark": "bar",
            "encoding": {
                "y": {
                    "field": "Country", 
                    "type": "nominal", 
                    "axis": {"title": ""},
                    "sort": {
                        "field": "InternetUsers", 
                        "order": "descending"
                    }
                },
                "x": {
                    "field": "Internet users (% of population)", 
                    "type": "quantitative",
                    "axis": {"title": "Internet Users (% of population)"}
                },
                "color": {
                    "field": "Internet users (% of population)",
                    "type": "quantitative",
                    "scale": {
                        "type": "threshold",
                        "domain": [10,30,50,70,90],
                        "scheme":"darkblue"
                    }
                },
                
                "stroke": {
                  "condition": {"param": "countryHover",
                                "empty": false, 
                                "value": "black"
                                },
                  "value": "black"
                },
                "strokeWidth": {
                  "condition": {"param": "countryHover",
                                "empty": false, 
                                "value": 1.8
                                },
                  "value": 0
                },
                "opacity": {
                  "condition": {"param": "countryHover",
                                "value": 1
                                },
                  "value": 0.5
                }
            }
        }
    ],
    "config": {
      "background": "#cfe0f2",
      "padding":20
    }
}
